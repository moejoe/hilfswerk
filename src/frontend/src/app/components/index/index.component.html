<mat-card class="mat-elevation-z8 filter-panel">
    <mat-card-title>Filter  <button mat-icon-button routerLink="/searchHelfer"><mat-icon>search</mat-icon></button></mat-card-title>
    <mat-card-content>
        <div class="filter-panel__filter-group">
            <mat-button-toggle class="plz-filter" *ngFor="let bezirk of bezirke" id="bezirk-{{bezirk.name}}"
                [checked]="bezirk.checked" (change)="[bezirk.checked = $event.source.checked, filterChange()] "
                name="bezirk-{{bezirk.name}}">
                {{bezirk.name}}</mat-button-toggle>
        </div>
        <div class="filter-panel__filter-group">
            <mat-button-toggle class="taetigkeit-filter" *ngFor="let taetigkeit of taetigkeiten"
                id="taetigkeit-{{taetigkeit.id}}"
                (change)="[taetigkeit.checked = $event.source.checked, filterChange()]"
                name="taetigkeit-{{taetigkeit.id}}">
                {{taetigkeit.name}}</mat-button-toggle>
        </div>
        <div class="filter-panel__filter-group">
            <mat-button-toggle id="hat-auto" class="sonstiges-filter"
                (change)="[hatAuto = $event.source.checked, filterChange()]">Auto verfügbar
            </mat-button-toggle>
            <mat-button-toggle id="ist-risikogruppe" class="sonstiges-filter"
                (change)="[istRisikoGruppe = $event.source.checked, filterChange()]">
                Risikogruppe
            </mat-button-toggle>
            <mat-button-toggle id="ist-freiwilliger" class="sonstiges-filter"
                (change)="[istFreiwilliger = $event.source.checked, filterChange()]">
                Freiwilliger
            </mat-button-toggle>
            <mat-button-toggle id="ist-zivildiener" class="sonstiges-filter"
                (change)="[istZivildiener = $event.source.checked, filterChange()]">
                Zivildiener
            </mat-button-toggle>
        </div>
    </mat-card-content>
</mat-card>

<div class="main-panel__container">
    <div class="main-panel__header">
        <h1>Verfügbare Helfer:innen</h1>
        <button mat-flat-button color="primary" routerLink="/createHelfer">Neue/n Helfer:in anlegen</button>    
    </div>
    <div class="table-container">
        <table mat-table [dataSource]="helfer$ | async" multiTemplateDataRows>
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let h">{{h.kontakt.nachname}} {{h.kontakt.vorname}}</td>
            </ng-container>
            <ng-container matColumnDef="einsaetze">
                <th mat-header-cell *matHeaderCellDef>Einsätze</th>
                <td mat-cell *matCellDef="let h">{{h.totalEinsaetze}}</td>
            </ng-container>
            <ng-container matColumnDef="strasse">
                <th mat-header-cell *matHeaderCellDef>Straße</th>
                <td mat-cell *matCellDef="let h">{{h.kontakt.strasse}}</td>
            </ng-container>
            <ng-container matColumnDef="plz">
                <th mat-header-cell *matHeaderCellDef>PLZ</th>
                <td mat-cell *matCellDef="let h">{{h.kontakt.plz}}</td>
            </ng-container>
            <ng-container matColumnDef="anmerkung">
                <th mat-header-cell *matHeaderCellDef>Anmerkungen</th>
                <td mat-cell *matCellDef="let h">{{h.anmerkung}}</td>
            </ng-container>
            <ng-container matColumnDef="expandedHelfer">
                <td mat-cell *matCellDef="let helfer" [attr.colspan]="5">
                    <div class="add-einsatz-container"
                        [@detailExpand]="helfer == selectedHelfer ? 'expanded' : 'collapsed'">
                        <div class="helfer-details">
                            <div>
                                <mat-icon>phone</mat-icon>{{helfer.kontakt.telefon}}
                            </div>
                            <div>
                                <mat-icon>email</mat-icon>{{helfer.kontakt.email}}
                            </div>
                            <div class="helfer-details-anmerkung">{{helfer.anmerkung}}</div>
                        </div>
                        <app-addEinsatz *ngIf="selectedHelfer === helfer" [vermitteltDurch]="userinfo.name"
                            [helferId]="helfer.id" (added)="onEinsatzAdded($event)">
                        </app-addEinsatz>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky : true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="helfer-row"
                [class.example-expanded-row]="selectedHelfer === row"
                (click)="selectedHelfer = selectedHelfer === row ? null : row"></tr>
            <tr mat-row *matRowDef="let row; columns: ['expandedHelfer']" class="expanded-helfer-row"></tr>
        </table>
    </div>
</div>